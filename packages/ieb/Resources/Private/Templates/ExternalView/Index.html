<html
        xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
        xmlns:ieb="http://typo3.org/ns/GeorgRinger/Ieb/ViewHelpers"
        data-namespace-typo3-fluid="true">
<f:layout name="Default"/>

<f:section name="content">
    <h1>Akkreditierte Ansuchen</h1>

    <f:form method="get" action="index" name="filter" object="{filter}">
        <div class="row archivfilter" >
            <div class="col-4">
                <label for="trPid">
                    Träger<br>
                    <f:form.select property="trPid" id="trPid" class="filter3" options="{options.tr}" prependOptionValue="-1" prependOptionLabel=""/>
                </label>
            </div>
            <div class="col-4">
                <label for="status">
                    Status<br>
                    <f:form.select property="status" id="status"  class="filter3" options="{options.status}" prependOptionValue="-1" prependOptionLabel=""/>
                </label>
            </div>
            <div class="col-2">
                <label for="ansuchenNummer">
                    Ansuchennummer<br>
                    <f:form.textfield property="ansuchenNummer"  class="filter" id="ansuchenNummer" />
                </label>
            </div>
        </div>
        <div class="row archivfilter">
            <div class="col-6">
                <label for="searchText">
                    Suchen im Ansuchen
                    <f:form.textfield property="search"  class="filter" id="searchText" />
                </label>
            </div>
        </div>
        <f:form.submit class="knopf-s" value="Anzeigen"/> <div class="knopf-s knopfersatz" id="zuruecksetzen">Filter zurücksetzen</div>

    </f:form>
    <div class="abstand-gross"></div>

    <f:if condition="{ansuchen}">
        <f:then>
            

                <f:for each="{ansuchen}" as="item">
                    <f:if condition="{item.version}>0">


                    {item.copyStammdatenData -> f:variable(name: 'stammdaten')}
                    <table class="ansuchenliste archiv">
                        <tr>
                            <td colspan="4" class="ansuchenliste_tr">
                                <f:if condition="{item.stammdatenMarkenname}">
                                    <f:then>
                                        <span class="fett">{stammdaten.markenname}</span> &nbsp;&nbsp;{stammdaten.name}
                                    </f:then>
                                    <f:else>
                                        <span class="fett">{stammdaten.name}</span>
                                    </f:else>
                                </f:if>
                            </td>
                        </tr>
                        <tr>
                            <td class="ansuchenliste_ansuchennr">
                                {item.nummer}<code>B: {item.bundesland}</code>
                            </td>
                            <td class="ansuchenliste_bezeichnung">
                                <span class="ansuchenliste_ansuchenname">{item.name} {item.uid}</span><br>
                                <f:if condition="{item.status}==100 || {item.status}==140">
                                    <f:then>
                                        <f:translate key="ansuchen.status.{item.status}" /> seit <f:format.date format='d.m.Y'>{item.akkreditierungDatum}</f:format.date> am <f:format.date format='d.m.Y'>{item.akkreditierungEntscheidungDatum}</f:format.date>
                                    </f:then>
                                    <f:else>
                                        <f:translate key="ansuchen.status.{item.status}" /> seit <f:format.date format='d.m.Y'>{item.akkreditierungDatum}</f:format.date>
                                    </f:else>
                                    
                                </f:if>
                                
                            </td>

                            <td class="td-knopf">
                                <f:if condition="{item.akkreditierungPdf}">
                                            <ieb:falFromRecord field="akkreditierung_pdf" id="{item.uid}" table="tx_ieb_domain_model_ansuchen" as="falItems">
                                                <f:if condition="{falItems.0}">
                                                    <a href="{falItems.0.publicUrl}" class="knopf-quadratisch zertifikat" target="_blank" title="Akkreditierungs-Zertifikat als PDF" >&#8288;</a>
                                                </f:if>
                                            </ieb:falFromRecord>
                                        </f:if>
                            </td>
                            <td class="td-knopf">
                                <f:if condition="{item.pp3} && {item.version}==0">
                                    <f:then>
                                        <span class="titleview knopfrund achtung-gelb " title="Das Ansuchen aus der PP3 ist in der neuen Akkreditierungsdatenbank noch nicht eingereicht worden. Details können daher noch nicht angezeigt werden."></span>
                                    </f:then>
                                    <f:else>
                                        <f:link.action action="show" pageUid="216" target="_blank" controller="Ansuchen" arguments="{ansuchen : item.uid}" class="knopf-quadratisch show" title="Ansuchen zeigen"></f:link.action>
                                    </f:else>
                                </f:if>
                            </td>
                        </tr>
                    </table>

                    </f:if>
                </f:for>
        </f:then>
        <f:else>
            <p>Keine Ansuchen vorhanden</p>
        </f:else>
    </f:if>
</f:section>

</html>