<html
        xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
        xmlns:ieb="http://typo3.org/ns/GeorgRinger/Ieb/ViewHelpers"
        data-namespace-typo3-fluid="true">
<f:layout name="Default" />

<f:section name="content">
    <f:if condition="{beraters -> f:count()} > 10">
        <div class="kriterium">
            <f:form action="index" id="suche" object="{beraterSearch}" name="beraterSearch">
                <div class="row">
                    <div class="col-5">
                        <label for="vorname">Vorname</label>
                        <f:form.textfield property="vorname" id="vorname" class="breite100" />
                    </div>
                    <div class="col-5">
                        <label for="nachname">Nachname</label>
                        <f:form.textfield property="nachname" id="nachname" class="breite100" />
                    </div>
                    <div class="col-2">
                        <f:form.submit value="Suche" class="knopf-s2 suche" />
                    </div>
                </div>
                <f:if condition="{beraterSearch.used}">
                    <div class="row">
                        <div class="col">
                            <p><span class="label">Gesucht wurde nach:</span> <span class="suchwort">»{beraterSearch.vorname} {beraterSearch.nachname}«</span></p>
                            <p>
                                <f:link.page class="knopf-s2 suchezurueck">Suche zurücksetzen</f:link.page>
                            </p>
                            <p>&nbsp;</p>
                        </div>
                    </div>
                </f:if>
            </f:form>
        </div>
    </f:if>

    <div class="formzeile">
        <f:link.action action="new" class="formlink berater">Neue Person anlegen</f:link.action>
    </div>

    <f:if condition="{beraters}">
        <table class="tx_ieb berater">
            <tr style="background: none;">
                <th class="nachname">
                    &nbsp;
                    </td>
                    <th class="vorname">
                        &nbsp;
                    </th>
                    <th>Info</th>
                    <th>letzte Änderung</th>

                    <th>Frist</th>
                    <th class="td-knopf">

                    </th>
                    <th class="td-knopf">

                    </th>
            </tr>
            <f:for each="{beraters}" as="berater">
                <f:variable name="relationUsagesInReview">{ieb:relationUsedInReview(object: berater)}</f:variable>
                <f:variable name="relationUsages">{ieb:relationUsed(object: berater)}</f:variable>
                <f:variable name="lockInformation">{ieb:lockedByCurrentUser(lockedBy: berater.lockedBy)}</f:variable>
                
                <f:if condition="!{berater.archiviert}">
                    <f:then>
                    <tr class="istok">
                            <td class="nachname">
                                {berater.nachname}
                            </td>
                            <td class="vorname">
                                {berater.vorname}
                            </td>
                            <td>
                                <f:if condition="{relationUsages}">
                            
                                    <span class="knopfrund ansuchenliste titleview" title="Wird in folgenden Ansuchen eingesetzt:<br><f:for each='{relationUsages}' as='relationUsage'>
                                        {relationUsage.nummer} ({relationUsage.name})<br>
                                    </f:for>"></span>
                                </f:if>
                            </td>
                            <td>{berater.tstamp -> f:format.date(format:'d.m.Y')}</td>
                            <td>
                                <f:if condition="!{relationUsagesInReview} && {berater.reviewFrist}">
                                    <f:format.date format="d.m.Y">{berater.reviewFrist}</f:format.date>
                                </f:if>
                            </td>
                            <td style="min-width: 80px;">
                                <f:if condition="!{berater.reviewC3Status} && !{berater.reviewC32Status} && {berater.ok}">
                                        <f:then>
                                            <span class="titleview knopfrund ok-grey" title="Angaben sind vollständig"></span>
                                        </f:then>
                                        <f:else>
                                            <f:if condition="!{relationUsagesInReview}">
                                                <f:then>
                                                    <f:switch expression="{berater.reviewC3Status}">
                                                        <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Qualifikationsnachweis"></span></f:case>
                                                        <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Qualifikationsnachweis"></span></f:case>
                                                        <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Qualifikationsnachweis"></span></f:case>
                                                    </f:switch>
                                                    <f:switch expression="{berater.reviewC32Status}">
                                                        <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Erfahrungsnachweis"></span></f:case>
                                                        <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Erfahrungsnachweis"></span></f:case>
                                                        <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Erfahrungsnachweis"></span></f:case>
                                                    </f:switch>
                                                </f:then>
                                                <f:else>
                                                    <span class="titleview knopfrund in-begutachtung" title="In Begutachtung"></span>
                                                </f:else>
                                            </f:if>
                                        </f:else>
                                    </f:if>
                            </td>
                            <td class="td-knopf">
                                <f:link.action action="show" title="Datensatz anzeigen" class="knopf-quadratisch show" arguments="{berater : berater}">
                                </f:link.action>
                            </td>
                            <td class="td-knopf">

                                <f:if condition="{berater.lockedBy}==0 || {berater.lockedBy}=={currentUser.uid}">
                                    <f:then>
                                        <f:if condition="{relationUsages}">
                                            <f:then>
                                                <f:link.action action="archive" title="Datensatz archivieren. <br><b>ACHTUNG</b>: wird verwendet in Ansuchen: <br><f:for each='{relationUsages}' as='relationUsage'> {relationUsage.nummer} ({relationUsage.name})<br></f:for> und wird automatisch aus diesem(n) Ansuchen entfernt." class="knopf-quadratisch hide" arguments="{berater : berater}"></f:link.action>
                                            </f:then>
                                            <f:else>
                                                <f:link.action action="archive" title="Datensatz archivieren" class="knopf-quadratisch hide" arguments="{berater : berater}"></f:link.action>
                                            </f:else> 
                                        </f:if>
                                        
                                    </f:then>
                                    <f:else>
                                        <div class="locked-grey knopf-quadratisch" title="Kann nicht archiviert werden, wird gerade von {lockInformation.lockedBy.name} bearbeitet."></div>
                                    </f:else>
                                </f:if>


                                
                                   
                                
                            </td>
                            <td class="td-knopf">
                                <f:if condition="{relationUsagesInReview}">
                                <f:then>
                                    <div class="locked knopf-quadratisch" title="In Begutachtung – Ansuchen: <br><f:for each='{relationUsagesInReview}' as='relationUsage'>
                                                {relationUsage.nummer} ({relationUsage.name})<br></f:for>">
                                    </div>
                                </f:then>
                                <f:else>
                                    <f:if condition="{berater.lockedBy}==0 ||  {berater.lockedBy}=={currentUser.uid}">
                                        <f:then>
                                            <f:link.action action="edit" title="Datensatz bearbeiten" class="knopf-quadratisch edit" arguments="{berater : berater}"></f:link.action>
                                        </f:then>
                                        <f:else>
                                            <f:link.action action="unlock" class="locked-to-unlock knopf-quadratisch" title="Kann nicht bearbeitet werden, wird gerade von {lockInformation.lockedBy.name} bearbeitet. <br>Klicken zum <b>Entsperren</b>"></f:link.action>
                                        </f:else>
                                    </f:if>
                                </f:else>
                               </f:if>

                                
                            </td>
                        </tr>
                    </f:then>
                    <f:else>
                        {f:variable(name: 'archiviertexistiert', value: 'ja')}
                    </f:else>
                </f:if>
            </f:for>
        </table>
    </f:if>
    <f:if condition="{beraters -> f:count()} > 6">
        <div class="formzeile">
            <f:link.action action="new" class="formlink berater">Neue Person anlegen</f:link.action>
        </div>
    </f:if>

    <f:if condition="{archiviertexistiert}=='ja'">
        <div class="abstand-mittel"></div>
        <div class="archiv">
            <h2>ARCHIV</h2>
            <table class="tx_ieb standortliste">
                <tr style="background: none;">
                    <th class="nachname">
                        &nbsp;
                        </td>
                        <th class="vorname">
                            &nbsp;
                        </th>
                        <th>Archivierung</th>
                        <th></th>
                        <th class="td-knopf">
    
                        </th>
                        <th class="td-knopf">
    
                        </th>
                        <th></th>
                </tr>
                <f:for each="{beraters}" as="berater">
                    <f:variable name="relationUsages">{ieb:relationUsed(object: berater)}</f:variable>
                    <f:if condition="{berater.archiviert}">
                        <tr class="{f:if(condition:berater.ok,then:'istok',else:'unok')}">
                            <td class="nachname">
                                {berater.nachname}
                            </td>
                            <td class="vorname">
                                {berater.vorname}
                            </td>
                            <td>{berater.tstamp -> f:format.date(format:'d.m.Y')}</td>
                            <td class="">
                                <f:if condition="!{berater.reviewC3Status} && {berater.ok}">
                                        <f:then>
                                            <span class="titleview knopfrund ok-grey" title="Angaben sind vollständig"></span>
                                        </f:then>
                                        <f:else>
                                            <f:switch expression="{berater.reviewC3Status}">
                                                <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt"></span></f:case>
                                                <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage"></span></f:case>
                                                <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok"></span></f:case>
                                            </f:switch>
                                        </f:else>
                                    </f:if>
                            </td>
                            <td class="td-knopf">
                                <f:link.action action="show" title="Datensatz anzeigen" class="knopf-quadratisch show" arguments="{berater : berater}">
                                </f:link.action>
                            </td>
                            <td class="td-knopf">
                                <f:link.action action="revive" title="Datensatz wiederherstellen" class="knopf-quadratisch revive" arguments="{berater : berater}">
                                </f:link.action>
                            </td>
                            <td class="td-knopf">

                            </td>
                        </tr>
                    </f:if>
                </f:for>
            </table>
        </div>
    </f:if>




</f:section>

</html>