<html
        xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
        xmlns:ieb="http://typo3.org/ns/GeorgRinger/Ieb/ViewHelpers"
        xmlns:pdf="http://typo3.org/ns/Bithost/Pdfviewhelpers/ViewHelpers"
        data-namespace-typo3-fluid="true">
<f:layout name="Default"/>

<f:section name="content">

    <pdf:document
            title="{ansuchen.nummer} {ansuchen.akkreditierungEntscheidungDatum -> f:format.date(format:'Y-m-d')} <f:translate key='ansuchen.status.{ansuchen.status}'/>"
            outputPath="Personal-Standorte_{ansuchen.nummer}_<f:format.date date='now' format='Y-m-d' />.pdf"
            outputDestination="inline"
            sourceFile="EXT:ieb/Resources/Private/Pdfs/esf.pdf">

            {ansuchen.copyStammdatenData -> f:variable(name: 'stammdaten')}
        <pdf:page importPage="1" margin="{top: 35, right: 16, bottom: 30, left: 16}">
            <pdf:html>

            <style>
                p {font-family: "opensans", sans-serif;font-size: 9pt;line-height:16pt;}
                td {font-family: "opensans", sans-serif;font-size: 9pt;line-height:14pt;}
            </style>

            <h2 style="font-family: opensans; font-size: 15pt; line-height:30pt;">Personal- und Standorteliste für:<br><span style="color:#c31a1e; ">{stammdaten.name}: {ansuchen.nummer} ({ansuchen.name}) </span></h2>
            <p style="font-size:8pt;font-family: opensans;">Stand <f:format.date date="now" format="d.m.Y" /></p>



                   
            </div>
            <div style="break-inside: avoid;position: relative;">
                <h2 style="font-family: opensans; color:#c31a1e;font-weight:300;font-size:12pt;">TRAINING</h2>
                
                <f:for each="{trainer}" as="t" iteration="i">
                    
                    <f:if condition="{altername} != {t.fullName}"><p style="line-height: 50%;">&nbsp;</p><p style="font-size: 10.5pt;">{t.fullName}</p></f:if>
                    <p style="font-size:9pt;line-height:3pt;">
                    {t.von -> f:format.date(format:'Y-m-d')} bis
                        <f:if condition="{t.bis} === 0">
                            <f:then>aktuell</f:then>
                            <f:else>{t.bis -> f:format.date(format:'Y-m-d')}</f:else>
                        </f:if>
                        <f:if condition="{ansuchen.typ}==2 || {t.auflage}">
                            <p>&nbsp;</p><p><span style="line-height:11pt"><f:if condition="{ansuchen.typ}==2">
                                        ({f:if(condition:'{t.qualifikationPsa1}==1', then:'D | ', else:'– | ')}{f:if(condition:'{t.qualifikationPsa2}==1', then:'E | ', else:'– | ')}{f:if(condition:'{t.qualifikationPsa3}==1', then:'M | ', else:'– | ')}{f:if(condition:'{t.qualifikationPsa4}==1', then:'B | ', else:'– | ')}{f:if(condition:'{t.qualifikationPsa5}==1', then:'K | ', else:'– | ')}{f:if(condition:'{t.qualifikationPsa6}==1', then:'G | ', else:'– | ')}{f:if(condition:'{t.qualifikationPsa7}==1', then:'N | ', else:'– | ')}{f:if(condition:'{t.qualifikationPsa8}==1', then:'{t.qualifikationPsaKommentar}', else:'– ')})*
                                    </f:if>
                                {t.auflage}</span></p>
                        </f:if>
                    </p>

                    <f:variable name="altername">{t.fullName}</f:variable>
                </f:for>   
            </div>



                <div style="page-break-inside: avoid;break-before: page;">
                <h2 style="font-family: opensans; color:#c31a1e;font-weight:300;font-size:12pt;break-before: page;">BERATUNG</h2>


                <f:for each="{berater}" as="t" iteration="i">
                    <f:if condition="{altername} != {t.fullName}"><p style="line-height: 50%;">&nbsp;</p><p style="font-size: 10.5pt;">{t.fullName}</p></f:if>
                    <p style="font-size:9pt;line-height:3pt;">
                    {t.von -> f:format.date(format:'Y-m-d')} bis
                        <f:if condition="{t.bis} === 0">
                            <f:then>aktuell</f:then>
                            <f:else>{t.bis -> f:format.date(format:'Y-m-d')}</f:else>
                        </f:if>
                        <f:if condition="{t.auflage}"><p>&nbsp;</p><p><span style="line-height:11pt"></span>
                            <br>{t.auflage}</p>
                        </f:if>
                    </p>

                    <f:variable name="altername">{t.fullName}</f:variable>
                </f:for>




            </div>
                <div style="page-break-inside: avoid;">
                <h2 style="font-family: opensans; color:#c31a1e;font-weight:300;font-size:12pt;">PROJEKTLEITUNG</h2>

                <f:for each="{projektleitung}" as="t" iteration="i">
                    <f:if condition="{altername} != {t.fullName}"><p style="line-height: 50%;">&nbsp;</p><p style="font-size: 10.5pt;">{t.fullName}</p></f:if>
                    <p style="font-size:9pt;line-height:3pt;">
                    {t.von -> f:format.date(format:'Y-m-d')} bis
                        <f:if condition="{t.bis} === 0">
                            <f:then>aktuell</f:then>
                            <f:else>{t.bis -> f:format.date(format:'Y-m-d')}</f:else>
                        </f:if>
                    </p>

                    <f:variable name="altername">{t.fullName}</f:variable>
                </f:for>

            </div>


            <div style="page-break-inside: avoid;">
                <h2 style="font-family: opensans; color:#c31a1e;font-weight:300;font-size:12pt;">STANDORTE</h2>


                <f:for each="{standorte}" as="t" iteration="i">
                    <f:if condition="{altername} != {t.name}"><p style="line-height: 50%;">&nbsp;</p><p style="font-size: 10.5pt;">{t.name} &nbsp;({t.plz} {t.ort}, {t.adresse})</p></f:if>
                    <p style="font-size:9pt;line-height:3pt;">
                    {t.von -> f:format.date(format:'Y-m-d')} bis
                        <f:if condition="{t.bis} === 0">
                            <f:then>aktuell</f:then>
                            <f:else>{t.bis -> f:format.date(format:'Y-m-d')}</f:else>
                        </f:if>
                    </p>

                    <f:variable name="altername">{t.name}</f:variable>
                </f:for>



                </div>
                <div style="page-break-inside: avoid;">
                <h2 style="font-family: opensans; color:#c31a1e;font-weight:300;font-size:12pt;">VERSIONENÜBERSICHT</h2>
                <p>(Versionen mit Akkreditierungsentscheidungen)</p>
                <table style="page-break-inside: avoid;">
                    <f:for each="{versions}" as="version" iteration="i">
                        <tr>
                        <f:variable name="akkreditierungEntscheidungDatum"></f:variable>
                        
                            <f:if condition="<f:format.date format='d.m.Y'>{version.akkreditierung_entscheidung_datum}</f:format.date> == <f:format.date format='d.m.Y'>{version.tstamp}</f:format.date>">
                                <f:then>
                                    <f:variable name="akkreditierungEntscheidungDatum">{version.akkreditierung_entscheidung_datum}</f:variable>
                                </f:then>
                                <f:else>
                                    <f:variable name="akkreditierungEntscheidungDatum">{version.tstamp}</f:variable>
                                </f:else>
                            </f:if>
                        
                        <td style="font-family: opensans;line-height:200%;border-top:solid 0.7mm #777;">    {akkreditierungEntscheidungDatum -> f:format.date(format:'d.m.Y')} bis <f:if condition="{versions.{i.cycle}.uid}">
                            
                                <f:then>
                                <f:variable name="nextAkkreditierungEntscheidungDatum"></f:variable>
                                <f:if condition="<f:format.date format='d.m.Y'>{versions.{i.cycle}.akkreditierung_entscheidung_datum}</f:format.date> == <f:format.date format='d.m.Y'>{versions.{i.cycle}.tstamp}</f:format.date>">
                                <f:then>
                                    <f:variable name="nextAkkreditierungEntscheidungDatum">{versions.{i.cycle}.akkreditierung_entscheidung_datum}</f:variable>
                                </f:then>
                                <f:else>
                                    <f:variable name="nextAkkreditierungEntscheidungDatum">{versions.{i.cycle}.tstamp}</f:variable>
                                </f:else>
                            </f:if>
                                    {nextAkkreditierungEntscheidungDatum -> f:format.date(format:'d.m.Y')}
                                </f:then>
                                <f:else>
                                    aktuell
                                </f:else>
                            </f:if>
                        </td>
                        <td style="font-family: opensans;line-height:200%;border-top:solid 0.7mm #777;">
                            <span style="font-size: 8pt;">Version {version.version + 1}: <f:switch expression="{version.status}"><f:case value="100">akkreditiert</f:case><f:case value="140">akkreditiert mit Auflagen</f:case></f:switch> &nbsp;&nbsp;<span style="color: #bbb;">[{version.uid}]</span></span>
                        </td>
                        </tr>
                    </f:for>
                </table>
                </div>

                <p style="font-size: 7pt">Die Nummerierung der Versionen folgt einer technischen Logik und gibt nicht unbedingt die Abfolge von Akkreditierungen an.</p>

               
            </pdf:html>
        </pdf:page>
    </pdf:document>
</f:section>

</html>