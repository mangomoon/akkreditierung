<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" xmlns:ieb="http://typo3.org/ns/GeorgRinger/Ieb/ViewHelpers" data-namespace-typo3-fluid="true">
<f:layout name="Default" />

<f:section name="content">

    <f:if condition="{trainers -> f:count()} > 10">
        <div class="kriterium">
            <f:form action="index" object="{trainerSearch}" name="trainerSearch">
                <div class="row">
                    <div class="col-5">
                        <label for="vorname">Vorname</label>
                        <f:form.textfield property="vorname" id="vorname" class="breite100" />
                    </div>
                    <div class="col-5">
                        <label for="nachname">Nachname</label>
                        <f:form.textfield property="nachname" id="nachname" class="breite100" />
                    </div>
                    <div class="col-2">
                        <f:form.submit value="Suche" class="knopf-s2 suche" />
                    </div>
                </div>
                <f:if condition="{trainerSearch.used}">
                    <div class="row">
                        <div class="col">
                            <p><span class="label">Gesucht wurde nach:</span> <span class="suchwort">»{trainerSearch.vorname} {trainerSearch.nachname}«</span>
                            </p>
                            <p>
                                <f:link.page class="knopf-s2 suchezurueck">Suche zurücksetzen</f:link.page>
                            </p>
                            <p>&nbsp;</p>
                        </div>
                    </div>
                </f:if>
            </f:form>
        </div>
    </f:if>
    <f:if condition="{currentUser.usergroup}=={extensionConfiguration.usergroupTr}">
        <div class="formzeile">
            <f:link.action action="new" class="formlink trainer">Neue Person anlegen</f:link.action>
        </div>
    </f:if>

    <f:flashMessages/>

    <f:if condition="{trainers}">

        <table class="tx_ieb trainer">
            <tr style="background: none;">
                <th class="nachname">
                    &nbsp;
                <th class="vorname">
                        &nbsp;
                </th>
                <th>Info</th>
                <th>letzte Änderung</th>
                <th>Frist</th>
                <th>BaBi</th>
                <th>PSA</th>
                <th class="td-knopf" colspan="3">
                   </th>
            </tr>
            <f:for each="{trainers}" as="trainer">
            <f:variable name="relationUsages">{ieb:relationUsed(object: trainer)}</f:variable>
            <f:variable name="relationUsagesInReview">{ieb:relationUsedInReview(object: trainer)}</f:variable>
            <f:variable name="lockInformation">{ieb:lockedByCurrentUser(lockedBy: trainer.lockedBy)}</f:variable>

                <f:if condition="!{trainer.archiviert}">
                    <f:then>


                        <!-- <f:if condition="{trainer.statusAfterReviewPsa}==3 || {trainer.statusAfterReviewBabi}==3">
                            <tr class="muss-edit">
                        </f:if>
                        <f:if condition="{trainer.statusAfterReviewPsa}==2 || {trainer.statusAfterReviewBabi}==2 || {trainer.statusAfterReviewPsa}==4 || {trainer.statusAfterReviewBabi}==4">
                            <tr class="muss-einreichen">
                        </f:if>
                        <f:if condition="{trainer.statusAfterReviewPsa} < 2 && {trainer.statusAfterReviewBabi} < 2">
                            <tr class="istok">
                        </f:if> -->
                        <tr class="istok">
                        <td class="nachname">
                            {trainer.nachname}
                            <code>uid: {trainer.uid} | okBabi: {trainer.okBabi} | okPsa: {trainer.okPsa} </code>
                        </td>
                        <td class="vorname">
                            {trainer.vorname}
                        </td>
                        <td><f:if condition="{relationUsages}">
                            
                            <span class="knopfrund ansuchenliste titleview" title="Wird in folgenden Ansuchen eingesetzt:<br><f:for each='{relationUsages}' as='relationUsage'>
                                {relationUsage.nummer} ({relationUsage.name})<br>
                            </f:for>"></span></f:if>
                        </td>
                        <td>{trainer.tstamp -> f:format.date(format:'d.m.Y')}</td>

                        <td>
                            <f:if condition="!{relationUsagesInReview} && {trainer.reviewFrist}">
                                <f:format.date format="d.m.Y">{trainer.reviewFrist}</f:format.date>
                            </f:if>
                            <f:if condition="!{relationUsagesInReview} && {trainer.reviewPsaFrist}">
                                <f:format.date format="d.m.Y">{trainer.reviewPsaFrist}</f:format.date>
                            </f:if>
                        </td>
                        <f:if condition="{trainer.verwendungBabi}">
                            <f:then>
                                <td class="istok">
                                    <f:if condition="!{trainer.reviewC21BabiStatus} && !{trainer.reviewC22BabiStatus} && {trainer.okBabi}">
                                        <f:then>
                                            <span class="titleview knopfrund ok-grey" title="Daten vorhanden"></span>
                                        </f:then>
                                        <f:else>
                                            <f:if condition="!{relationUsagesInReview}">
                                                <f:then>
                                                    <f:switch expression="{trainer.reviewC21BabiStatus}">
                                                        <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Qualifikationsnachweis"></span></f:case>
                                                        <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Qualifikationsnachweis"></span></f:case>
                                                        <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Qualifikationsnachweis"></span></f:case>
                                                    </f:switch>
                                                    <f:switch expression="{trainer.reviewC22BabiStatus}">
                                                        <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Erfahrungsnachweis"></span></f:case>
                                                        <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Erfahrungsnachweis"></span></f:case>
                                                        <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Erfahrungsnachweis"></span></f:case>
                                                    </f:switch>
                                                </f:then>
                                                <f:else>
                                                    <span class="titleview knopfrund in-begutachtung" title="In Begutachtung"></span>
                                                </f:else>
                                            </f:if>
                                        </f:else>
                                    </f:if>
                                </td>
                            </f:then>
                            <f:else>
                                <td></td>
                            </f:else>
                        </f:if>
                        

                        <!-- PSA -->
                        <f:if condition="{trainer.verwendungPsa}">
                            <f:then>
                                        <td class="istok">
                                            <f:if condition="!{trainer.reviewC21PsaStatus} && !{trainer.reviewC22PsaStatus} && {trainer.okPsa}">
                                                <f:then>
                                                    <span class="titleview knopfrund ok-grey" title="Daten vorhanden"></span>
                                                </f:then>
                                                <f:else>
                                                    <f:if condition="!{relationUsagesInReview}">
                                                        <f:then>
                                                            <f:switch expression="{trainer.reviewC21PsaStatus}">
                                                                <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Qualifikationsnachweis"></span></f:case>
                                                                <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Qualifikationsnachweis"></span></f:case>
                                                                <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Qualifikationsnachweis"></span></f:case>
                                                            </f:switch>
                                                            <f:switch expression="{trainer.reviewC22PsaStatus}">
                                                                <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Erfahrungsnachweis"></span></f:case>
                                                                <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Erfahrungsnachweis"></span></f:case>
                                                                <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Erfahrungsnachweis"></span></f:case>
                                                            </f:switch>
                                                        </f:then>
                                                        <f:else>
                                                            <span class="titleview knopfrund in-begutachtung" title="In Begutachtung"></span>
                                                        </f:else>
                                                    </f:if>
                                                </f:else>
                                            </f:if>
                                        </td>
                            </f:then>
                            <f:else>
                                <td></td>
                            </f:else>
                        </f:if>
                        

                        <td class="td-knopf">
                            <f:link.action action="show" title="Datensatz anzeigen" class="knopf-quadratisch show" arguments="{trainer : trainer}">
                            </f:link.action>
                        </td>
                        
                        <td class="td-knopf">
                            <f:if condition="{relationUsagesInReview}">
                                <f:then>
                                    <div class="locked-grey knopf-quadratisch" title="In Begutachtung und kann daher nicht archiviert werden."></div>
                                </f:then>
                                <f:else>
                                    <f:if condition="{trainer.lockedBy}==0 ||  {trainer.lockedBy}=={currentUser.uid} || !{relationUsagesInReview}">
                                        <f:then>
                                            <f:if condition="{relationUsages}">
                                                <f:then>
                                                    <div class="personarchivieren knopf-quadratisch hide" title="Datensatz archivieren"><div class="modalcontent hidden"><p><b>ACHTUNG</b>: wird verwendet in Ansuchen: <br><f:for each='{relationUsages}' as='relationUsage'>
                                                        {relationUsage.nummer} ({relationUsage.name})<br></f:for> und wird automatisch aus diesem(n) Ansuchen entfernt.</p><p><f:link.action action="archive" title="Datensatz archivieren." class="knopf knopf-s2" arguments="{trainer : trainer}">Datensatz archivieren</f:link.action></p></div>
                                                    </div>
                                                    <!-- <f:link.action action="archive" title="Datensatz archivieren. <br><b>ACHTUNG</b>: wird verwendet in Ansuchen: <br><f:for each='{relationUsages}' as='relationUsage'>
                                                        {relationUsage.nummer} ({relationUsage.name})<br></f:for> und wird automatisch aus diesem(n) Ansuchen entfernt." class="knopf-quadratisch hide" arguments="{trainer : trainer}"></f:link.action> -->
                                                </f:then>
                                                <f:else>
                                                    <f:link.action action="archive" title="Datensatz archivieren" class="knopf-quadratisch hide" arguments="{trainer : trainer}"></f:link.action>
                                                </f:else>
                                            </f:if>
                                        </f:then>
                                        <f:else>
                                                    <div class="locked-grey knopf-quadratisch" title="Kann nicht archiviert werden, wird gerade von {lockInformation.lockedBy.first_name} {lockInformation.lockedBy.last_name} bearbeitet."></div>
                                        </f:else>
                                    </f:if>
                                </f:else>
                            </f:if>
                            
                                

                        </td>
                        <td class="td-knopf">
                            <f:if condition="{relationUsagesInReview}">
                                <f:then>
                                    <div class="locked knopf-quadratisch" title="In Begutachtung – Ansuchen: <br><f:for each='{relationUsagesInReview}' as='relationUsage'>
                                                {relationUsage.nummer} ({relationUsage.name})<br></f:for>">
                                    </div>
                                </f:then>
                                <f:else>
                                    <f:if condition="{trainer.lockedBy}==0 ||  {trainer.lockedBy}=={currentUser.uid}">
                                        <f:then>
                                            <f:link.action action="edit" title="Datensatz bearbeiten" class="knopf-quadratisch edit" arguments="{trainer : trainer}"></f:link.action>
                                        </f:then>
                                        <f:else>
                                            <f:link.action action="unlock" class="locked-to-unlock knopf-quadratisch" title="Kann nicht bearbeitet werden, wird gerade von {lockInformation.lockedBy.first_name} {lockInformation.lockedBy.last_name} bearbeitet. <br>Klicken zum <b>Entsperren</b>" arguments="{trainer : trainer}"></f:link.action>
                                        </f:else>
                                    </f:if>
                                </f:else>
                               </f:if>
                                

                        </td>
                        </tr>
                    </f:then>
                    <f:else>
                        {f:variable(name: 'archiviertexistiert', value: 'ja')}
                    </f:else>
                </f:if>
            </f:for>
        </table>

<!-- ARCHIV ########## -->
<f:if condition="{trainers -> f:count()} > 6">
    <div class="formzeile">
        <f:link.action action="new" class="formlink trainer">Neue Person anlegen</f:link.action>
    </div>
</f:if>
        <f:if condition="{archiviertexistiert}=='ja'">
            <div class="abstand-mittel"></div>
            <div class="archiv">
                <h2>&nbsp;&nbsp;ARCHIV</h2>
                <table class="tx_ieb standortliste">
                    <tr>
                        <th class="nachname">
                            &nbsp;
                        <th class="vorname">
                                &nbsp;
                        </th>
                        <th>Archiviert am</th>
                        <th>BaBi</th>
                        <th>PSA</th>
                        <th class="td-knopf" colspan="3">
                           </th>
                    </tr>
                    <f:for each="{trainers}" as="trainer">
                        <f:if condition="{trainer.archiviert}">
                            <f:then>
                        <f:if condition="{trainer.okbabi} || {trainer.okpsa}">
                            <f:then>
                                <tr class="istok">
                            </f:then>
                            <f:else>
                                <tr class="istok">
                            </f:else>
                        </f:if>

                        <td class="nachname">
                            {trainer.nachname} 
                        </td>
                        <td class="vorname">
                            {trainer.vorname}
                        </td>

                        </td>
                        <td>{trainer.tstamp -> f:format.date(format:'d.m.Y')}</td>
                        <!-- BaBi -->
                        <f:if condition="{trainer.verwendungBabi}">
                            <f:then>
                                <td class="istok">
                                <f:if condition="!{trainer.reviewC21BabiStatus} && !{trainer.reviewC22BabiStatus} && {trainer.okBabi}">
                                        <f:then>
                                            <span class="titleview knopfrund ok-grey" title="Angaben sind vollständig"></span>
                                        </f:then>
                                        <f:else>
                                            <f:switch expression="{trainer.reviewC21BabiStatus}">
                                                <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Qualifikationsnachweis"></span></f:case>
                                                <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Qualifikationsnachweis"></span></f:case>
                                                <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Qualifikationsnachweis"></span></f:case>
                                            </f:switch>
                                            <f:switch expression="{trainer.reviewC22BabiStatus}">
                                                <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Erfahrungsnachweis"></span></f:case>
                                                <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Erfahrungsnachweis"></span></f:case>
                                                <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Erfahrungsnachweis"></span></f:case>
                                            </f:switch>
                                        </f:else>
                                    </f:if>
                                    
                            </f:then>
                            <f:else>
                                <td></td>
                            </f:else>
                            </td>
                        </f:if>
                        

                        <!-- PSA -->
                        <f:if condition="{trainer.verwendungPsa}">
                            <f:then>
                                <td class="istok">
                                <f:if condition="!{trainer.reviewC21PsaStatus} && !{trainer.reviewC22PsaStatus} && {trainer.okPsa}">
                                                <f:then>
                                                    <span class="titleview knopfrund ok-grey" title="Angaben sind vollständig"></span>
                                                </f:then>
                                                <f:else>
                                                    <f:switch expression="{trainer.reviewC21PsaStatus}">
                                                        <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Qualifikationsnachweis"></span></f:case>
                                                        <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Qualifikationsnachweis"></span></f:case>
                                                        <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Qualifikationsnachweis"></span></f:case>
                                                    </f:switch>
                                                    <f:switch expression="{trainer.reviewC22PsaStatus}">
                                                        <f:case value="1"><span class="titleview knopfrund auflage-1" title="Begutachtung: anerkannt für Erfahrungsnachweis"></span></f:case>
                                                        <f:case value="3"><span class="titleview knopfrund auflage-3" title="Begutachtung: Auflage für Erfahrungsnachweis"></span></f:case>
                                                        <f:case value="4"><span class="titleview knopfrund auflage-4" title="Begutachtung: nicht-ok für Erfahrungsnachweis"></span></f:case>
                                                    </f:switch>
                                                </f:else>
                                            </f:if>
                            </f:then>
                            <f:else>
                                <td></td>
                            </f:else>
                        </td>
                        </f:if>
                        

                        <td class="td-knopf">
                            <f:link.action action="show" title="Datensatz anzeigen" class="knopf-quadratisch show" arguments="{trainer : trainer}">
                            </f:link.action>
                        </td>

                        <td class="td-knopf">
                            <f:link.action action="revive" title="Datensatz wiederherstellen" class="knopf-quadratisch revive" arguments="{trainer : trainer}"></f:link.action>
                        </td>
                        <td class="td-knopf">
                            

                        </td>
                        </tr>
                    </f:then>
                        </f:if>
                    </f:for>
                </table>
            </div>
        </f:if>

    </f:if>


</f:section>

</html>