<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" xmlns:ieb="http://typo3.org/ns/GeorgRinger/Ieb/ViewHelpers" data-namespace-typo3-fluid="true">
<f:layout name="Default" />

<f:section name="content">
    
    <f:if condition="{trainers -> f:count()} > 10">
        <div class="kriterium">
            <f:form action="index" object="{trainerSearch}" name="trainerSearch">
                <div class="row">
                    <div class="col-5">
                        <label for="vorname">Vorname</label>
                        <f:form.textfield property="vorname" id="vorname" class="breite100" />
                    </div>
                    <div class="col-5">
                        <label for="nachname">Nachname</label>
                        <f:form.textfield property="nachname" id="nachname" class="breite100" />
                    </div>
                    <div class="col-2">
                        <f:form.submit value="Suche" class="knopf-s2 suche" />
                    </div>
                </div>
                <f:if condition="{trainerSearch.used}">
                    <div class="row">
                        <div class="col">
                            <p><span class="label">Gesucht wurde nach:</span> <span class="suchwort">»{trainerSearch.vorname} {trainerSearch.nachname}«</span>
                            </p>
                            <p>
                                <f:link.page class="knopf-s2 suchezurueck">Suche zurücksetzen</f:link.page>
                            </p>
                            <p>&nbsp;</p>
                        </div>
                    </div>
                </f:if>
            </f:form>
        </div>
    </f:if>

    <div class="formzeile">
        <f:link.action action="new" class="formlink trainer">Neue Person anlegen</f:link.action>
    </div>

    <f:flashMessages/>

    <f:if condition="{trainers}">

        <table class="tx_ieb trainer">
            <tr>
                <th class="nachname">
                    &nbsp;
                <th class="vorname">
                        &nbsp;
                </th>
                <th>Info</th>
                <th>letzte Änderung</th>
                <th>BaBi</th>
                <th>PSA</th>
                <th class="td-knopf" colspan="3">
                   </th>
            </tr>
            <f:for each="{trainers}" as="trainer">
                <f:if condition="!{trainer.archiviert}">
                    <f:then>
                        <f:if condition="{trainer.okbabi} || {trainer.okpsa}">
                            <f:then>
                                <tr class="istok">
                            </f:then>
                            <f:else>
                                <tr class="unok">
                            </f:else>
                        </f:if>

                        <td class="nachname">
                            {trainer.nachname} 
                        </td>
                        <td class="vorname">
                            {trainer.vorname}
                        </td>
                        <td>
                            <f:variable name="relationUsages">{ieb:relationUsed(object: trainer)}</f:variable>
                            <span class="knopfrund ansuchenliste titleview" title="Wird in folgenden Ansuchen eingesetzt:<br><f:for each='{relationUsages}' as='relationUsage'>
                                {relationUsage.nummer} ({relationUsage.name})<br>
                            </f:for>"></span>
                        </td>
                        <td>{trainer.tstamp -> f:format.date(format:'d.m.Y')}</td>
                        <!-- BaBi -->
                        <f:if condition="{trainer.verwendungBabi}">
                            <f:then>
                                <f:if condition="{trainer.okbabi}">
                                    <f:then>
                                        <td class="istok"><span class="titleview knopfrund ok" title="Angaben sind vollständig"></span></td>
                                    </f:then>
                                    <f:else>
                                        <td class="istok">
                                            <f:if condition="{trainer.reviewC21BabiStatus}"><span class="titleview knopfrund auflage-{trainer.reviewC21BabiStatus}"></span></f:if>
                                            <f:if condition="{trainer.reviewC21BabiStatus}"><span class="titleview knopfrund auflage-{trainer.reviewC22BabiStatus}"></span></f:if>
                                        </td>
                                    </f:else>
                                </f:if>
                            </f:then>
                            <f:else>
                                <td></td>
                            </f:else>
                        </f:if>
                        

                        <!-- PSA -->
                        <f:if condition="{trainer.verwendungPsa}">
                            <f:then>
                                <f:if condition="{trainer.okpsa}">
                                    <f:then>
                                        <td class="istok">
                                            <f:if condition="{trainer.reviewC21PsaStatus} > 0">
                                                <f:then>
                                                    <span class="knopfrund auflage-{trainer.reviewC21PsaStatus}"></span>
                                                </f:then>
                                                <f:else>
                                                    <span class="knopfrund ok"></span>
                                                </f:else>
                                            </f:if>
                                        </td>
                                    </f:then>
                                    <f:else>
                                        <td class="istok">
                                            <f:if condition="{trainer.reviewC21PsaStatus} > 2"><span class="titleview knopfrund auflage-{trainer.reviewC21PsaStatus}" title="Begutachtung"></span></f:if>
                                            <f:if condition="{trainer.reviewC22PsaStatus} > 2"><span class="titleview knopfrund auflage-{trainer.reviewC22PsaStatus}" title="Begutachtung"></span></f:if>
                                            <f:if condition="({trainer.reviewC21PsaStatus} < 3) && ({trainer.reviewC22PsaStatus} < 3)"><span class="titleview knopfrund nicht-ok"></span></f:if>
                                        </td>
                                    </f:else>
                                </f:if>
                            </f:then>
                            <f:else>
                                <td></td>
                            </f:else>
                        </f:if>
                        

                        <td class="td-knopf">
                            <f:link.action action="show" title="Datensatz anzeigen" class="knopf-quadratisch show" arguments="{trainer : trainer}">
                            </f:link.action>
                        </td>
                        <f:variable name="relationUsagesInReview">{ieb:relationUsedInReview(object: trainer)}</f:variable>
                        <td class="td-knopf">
                            <f:if condition="{relationUsagesInReview}">
                                <f:then>

                                </f:then>
                                <f:else>
                                    <f:link.action action="archive" title="Datensatz archivieren" class="knopf-quadratisch hide" arguments="{trainer : trainer}">
                                    </f:link.action>

                                </f:else>
                            </f:if>
                        </td>
                        <td class="td-knopf">
                            <f:if condition="{relationUsagesInReview}">
                                <f:then>
                                    <div class="locked knopf-quadratisch" title="In Begutachtung – Ansuchen: <br><f:for each='{relationUsagesInReview}' as='relationUsage'>
                                        {relationUsage.nummer} ({relationUsage.name})<br>
                                    </f:for>"></div>
                                </f:then>
                                <f:else>
                                    <f:link.action action="edit" title="Datensatz bearbeiten" class="knopf-quadratisch edit" arguments="{trainer : trainer}">
                                    </f:link.action>
                                </f:else>
                            </f:if>

                        </td>
                        </tr>
                    </f:then>
                    <f:else>
                        {f:variable(name: 'archiviertexistiert', value: 'ja')}
                    </f:else>
                </f:if>
            </f:for>
        </table>
        <f:if condition="{archiviertexistiert}=='ja'">
            <div class="abstand-mittel"></div>
            <div class="archiv">
                <h2>ARCHIV</h2>
                <table class="tx_ieb standortliste">
                    <f:for each="{trainers}" as="trainer">
                        <f:if condition="{trainer.archiviert}">
                            <tr class="{f:if(condition:trainer.ok,then:'istok',else:'unok')}">
                                <td class="nachname">
                                    {trainer.nachname}
                                </td>
                                <td class="vorname">
                                    {trainer.vorname}
                                </td>
                                <td>{trainer.tstamp -> f:format.date(format:'d.m.Y')}</td>
                                <td class="">
                                    <f:if condition="{trainer.okbabi}">
                                        <f:then>
                                            ja
                                        </f:then>
                                        <f:else>
                                            nein
                                        </f:else>
                                    </f:if>

                                </td>
                                <td class="">
                                    <f:if condition="{trainer.okpsa}">
                                        <f:then>
                                            ja
                                        </f:then>
                                        <f:else>
                                            nein
                                        </f:else>
                                    </f:if>

                                    <td class="td-knopf">
                                        <f:link.action action="show" title="Datensatz anzeigen" class="knopf-quadratisch show" arguments="{trainer : trainer}">
                                        </f:link.action>
                                    </td>
                                    <td class="td-knopf">
                                        <f:link.action action="revive" title="Datensatz wiederherstellen" class="knopf-quadratisch revive" arguments="{trainer : trainer}">
                                        </f:link.action>
                                    </td>
                                    <td class="td-knopf">

                                    </td>
                            </tr>
                        </f:if>
                    </f:for>
                </table>
            </div>
        </f:if>

    </f:if>

    <div class="formzeile">
        <f:link.action action="new" class="formlink trainer">Neue Person anlegen</f:link.action>
    </div>
</f:section>

</html>