<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" xmlns:ieb="http://typo3.org/ns/GeorgRinger/Ieb/ViewHelpers" data-namespace-typo3-fluid="true">
    
    {ansuchen.copyTrainerData -> f:variable(name: 'trainer')}
    {ansuchen.copyBeraterData -> f:variable(name: 'berater')} 
    
    <f:variable name="tsarBabi">0</f:variable>
    <f:variable name="tsarPsa">0</f:variable>
    <f:variable name="bsar">0</f:variable>

    <f:for each="{trainer}" as="t">
        <f:if condition="{ansuchen.typ}==1">
            <f:then>
                <f:if condition="{t.statusAfterReviewBabi} > {tsarBabi}">
                    <f:variable name="tsarBabi">{t.statusAfterReviewBabi}</f:variable>
                </f:if>
            </f:then>
            <f:else>
                <f:if condition="{t.statusAfterReviewPsa} > {tsarPsa}">
                    <f:variable name="tsarPsa">{t.statusAfterReviewBabi}</f:variable>
                </f:if>
            </f:else>
        </f:if>
    </f:for>
    
    <f:for each="{berater}" as="b">
        <f:if condition="{b.statusAfterReview} > {bsar}">
            <f:variable name="bsar">{b.statusAfterReview}</f:variable>
        </f:if>
    </f:for>

    <code>
        <f:for each="{ansuchen.trainer}" as="t">
            <f:format.date format="d.m.Y">{t.reviewFrist}</f:format.date>
        </f:for>
        <f:format.date format="d.m.Y">{item.reviewTotalFrist}</f:format.date>
    </code>

    <!-- ANSUCHEN -->
    <f:if condition="{ansuchen.ok} && ({ansuchen.statusAfterReview}==0)">
        <span class="titleview knopfrund ok-grey" title="ANSUCHEN: Angaben sind vollständig"></span>
    </f:if>
    <f:if condition="!{ansuchen.ok} && ({ansuchen.statusAfterReview}==0)">
        <span class="titleview knopfrund achtung-gelb" title="ANSUCHEN: Angaben sind unvollständig"></span>
    </f:if>
    <f:if condition="{ansuchen.statusAfterReview}==1">
        <span class="titleview knopfrund auflage-1" title="ANSUCHEN: Begutachtung positiv"></span>
    </f:if>
    <f:if condition="{ansuchen.statusAfterReview}==2">
        <span class="titleview knopfrund achtung-gelb" title="ANSUCHEN: Angaben bearbeitet. Neueinreichung ist möglicherweise erforderlich"></span>
    </f:if>
    <f:if condition="{ansuchen.statusAfterReview}==3">
        <span class="titleview knopfrund achtung-orange" title="ANSUCHEN: Begutachtung negativ. Bearbeitung ist erforderlich"></span>
    </f:if>
    <f:if condition="{ansuchen.statusAfterReview}>3">
        <span class="titleview knopfrund achtung-gelb" title="ANSUCHEN: Angaben zu negativer Begutachtungen bearbeitet. Neueinreichung ist erforderlich"></span>
    </f:if>


    <!-- STAMMDATEN -->
    <f:if condition="{stammdaten.ok} && ({stammdaten.statusAfterReview}==0)">
        <span class="titleview knopfrund ok-grey" title="STAMMDATEN: Angaben sind vollständig"></span>
    </f:if>
    <f:if condition="!{stammdaten.ok} && ({stammdaten.statusAfterReview}==0)">
        <span class="titleview knopfrund achtung-gelb" title="STAMMDATEN: Angaben sind unvollständig"></span>
    </f:if>
    <f:if condition="{stammdaten.statusAfterReview}==1">
        <span class="titleview knopfrund auflage-1" title="STAMMDATEN: Begutachtung positiv"></span>
    </f:if>
    <f:if condition="{stammdaten.statusAfterReview}==2">
        <span class="titleview knopfrund achtung-gelb" title="STAMMDATEN: Angaben bearbeitet. Neueinreichung ist möglicherweise erforderlich"></span>
    </f:if>
    <f:if condition="{stammdaten.statusAfterReview}==3">
        <span class="titleview knopfrund achtung-orange" title="STAMMDATEN: Begutachtung negativ. Bearbeitung ist erforderlich"></span>
    </f:if>
    <f:if condition="{stammdaten.statusAfterReview}>3">
        <span class="titleview knopfrund achtung-gelb" title="STAMMDATEN: Angaben zu negativer Begutachtungen bearbeitet. Neueinreichung ist erforderlich"></span>
    </f:if> 

    <!-- TRAINING -->
    <f:if condition="{ansuchen.typ}==1">
        <f:then>
            <f:if condition="{tsarBabi}==0">
                <span class="titleview knopfrund ok-grey" title="TRAINING: Personen nicht begutachtet. Einreichung erforderlich."></span>
            </f:if>
            <f:if condition="{tsarBabi}==1">
                <span class="titleview knopfrund auflage-1" title="TRAINING: Begutachtung positiv"></span>
            </f:if>
            <f:if condition="{tsarBabi}==2">
                <span class="titleview knopfrund achtung-gelb" title="TRAINING: Angaben bearbeitet. Neueinreichung ist möglicherweise erforderlich"></span>
            </f:if>
            <f:if condition="{tsarBabi}==3">
                <span class="titleview knopfrund achtung-orange" title="TRAINING: Negative Begutachtung(en). Bearbeitung erforderlich: <br><f:for each='{ansuchen.trainer}' as='t'>
                    {t.vorname} {t.nachname}: Frist <f:format.date format='d.m.Y'>{t.reviewFrist}</f:format.date><br>
                </f:for>"></span>
            </f:if>
            <f:if condition="{tsarBabi}>3">
                <span class="titleview knopfrund achtung-gelb" title="TRAINING: Angaben bearbeit. Neueinreichung ist erforderlich"></span>
            </f:if>
        </f:then>
        <f:else>
            <f:if condition="{tsarPsa}==0">
                <span class="titleview knopfrund ok-grey" title="TRAINING: Personen nicht begutachtet. Einreichung erforderlich."></span>
            </f:if>
            <f:if condition="{tsarPsa}==1">
                <span class="titleview knopfrund ok-grey" title="TRAINING: Begutachtung positiv"></span>
            </f:if>
            <f:if condition="{tsarPsa}==2">
                <span class="titleview knopfrund ok-grey" title="TRAINING: Angaben bearbeitet. Neueinreichung ist möglicherweise erforderlich"></span>
            </f:if>
            <f:if condition="{tsarPsa}==3">
                <span class="titleview knopfrund ok-grey" title="TRAINING: Negative Begutachtung(en). Bearbeitung erforderlich: <br><f:for each='{ansuchen.trainer}' as='t'>
                    {t.vorname} {t.nachname}: Frist <f:format.date format='d.m.Y'>{t.reviewFrist}</f:format.date><br>
                </f:for>"></span>
            </f:if>
            <f:if condition="{tsarPsa}>3">
                <span class="titleview knopfrund ok-grey" title="TRAINING: Angaben bearbeit. Neueinreichung ist erforderlich"></span>
            </f:if>
        </f:else>
    </f:if>


    <!-- BERATUNG -->
        <f:if condition="{bsar}==0">
            <span class="titleview knopfrund ok-grey" title="BERATUNG: Personen nicht begutachtet. Einreichung erforderlich."></span>
        </f:if>
        <f:if condition="{bsar}==1">
            <span class="titleview knopfrund ok-grey" title="BERATUNG: Begutachtung positiv"></span>
        </f:if>
        <f:if condition="{bsar}==2">
            <span class="titleview knopfrund ok-grey" title="BERATUNG: Angaben bearbeitet. Neueinreichung ist möglicherweise erforderlich"></span>
        </f:if>
        <f:if condition="{bsar}==3">
            <span class="titleview knopfrund ok-grey" title="BERATUNG: Negative Begutachtung(en). Bearbeitung erforderlich: <br><f:for each='{ansuchen.trainer}' as='t'>
                {t.vorname} {t.nachname}: Frist <f:format.date format='d.m.Y'>{t.reviewFrist}</f:format.date><br>
            </f:for>"></span>
        </f:if>
        <f:if condition="{bsar}>3">
            <span class="titleview knopfrund ok-grey" title="BERATUNG: Angaben bearbeit. Neueinreichung ist erforderlich"></span>
        </f:if>    
     
</html>